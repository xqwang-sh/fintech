{
  "hash": "f1710ddf212949abbdd164fe7b96e31a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: 第二讲上机实践\n---\n\n\n\n本上机讲义覆盖以下内容：\n\n- Pandas 读取/探索\n- 缺失值与异常值处理\n- 可视化（散点图、直方图、箱线图、相关矩阵）\n- 线性回归训练、评估（MAE/RMSE）、残差分析\n\n数据：使用经典的 Boston Housing 数据集（房价预测数据集）。\n\n## 导入库\n\n::: {#ab1e0b89 .cell message='false' execution_count=2}\n``` {.python .cell-code}\n# 导入库\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# Boston housing 数据集已从 sklearn 中移除，我们从原始数据源获取\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_absolute_error, mean_squared_error\n```\n:::\n\n\n## 数据读取与基本概览\n\n::: {#8e5d6e9d .cell message='false' execution_count=3}\n``` {.python .cell-code}\n# 读取数据与基本概览\n# 加载 Boston Housing 数据集\ndata_url = \"http://lib.stat.cmu.edu/datasets/boston\"\nraw_df = pd.read_csv(data_url, sep=\"\\s+\", skiprows=22, header=None)\ndata = np.hstack([raw_df.values[::2, :], raw_df.values[1::2, :2]])\ntarget = raw_df.values[1::2, 2]\n\n# 创建DataFrame\nfeature_names = ['CRIM', 'ZN', 'INDUS', 'CHAS', 'NOX', 'RM', 'AGE', 'DIS', 'RAD', 'TAX', 'PTRATIO', 'B', 'LSTAT']\ndf = pd.DataFrame(data, columns=feature_names)\ndf['MEDV'] = target  # 添加目标变量（房价）\n\nprint(\"Boston Housing 数据集描述:\")\nprint(\"经典的房价预测数据集，包含506个样本和13个特征变量。\")\nprint(\"目标变量：MEDV (房价，单位：千美元)\")\nprint(\"\\n特征说明:\")\nprint(\"- CRIM: 城镇人均犯罪率\")\nprint(\"- ZN: 占地面积超过25,000平方英尺的住宅用地比例\")\nprint(\"- INDUS: 城镇非零售商业用地比例\")\nprint(\"- CHAS: Charles River虚拟变量 (= 1 if tract bounds river; 0 otherwise)\")\nprint(\"- NOX: 一氧化氮浓度 (parts per 10 million)\")\nprint(\"- RM: 平均每户房间数\")\nprint(\"- AGE: 1940年以前建造的自住单位比例\")\nprint(\"- DIS: 到五个波士顿就业中心的加权距离\")\nprint(\"- RAD: 径向公路可达性指数\")\nprint(\"- TAX: 每10,000美元的全值财产税率\")\nprint(\"- PTRATIO: 城镇师生比例\")\nprint(\"- B: 1000(Bk - 0.63)^2，其中Bk是城镇黑人比例\")\nprint(\"- LSTAT: 低地位人口百分比\")\n\nprint(\"\\n数据形状:\", df.shape)\nprint(\"\\n特征名称:\", list(feature_names))\nprint(\"\\n目标变量: MEDV (房价，单位：千美元)\")\n\nprint(\"\\n数据预览:\")\nprint(df.head())\nprint(\"\\n数据信息:\")\nprint(df.info())\nprint(\"\\n数据统计:\")\nprint(df.describe())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nBoston Housing 数据集描述:\n经典的房价预测数据集，包含506个样本和13个特征变量。\n目标变量：MEDV (房价，单位：千美元)\n\n特征说明:\n- CRIM: 城镇人均犯罪率\n- ZN: 占地面积超过25,000平方英尺的住宅用地比例\n- INDUS: 城镇非零售商业用地比例\n- CHAS: Charles River虚拟变量 (= 1 if tract bounds river; 0 otherwise)\n- NOX: 一氧化氮浓度 (parts per 10 million)\n- RM: 平均每户房间数\n- AGE: 1940年以前建造的自住单位比例\n- DIS: 到五个波士顿就业中心的加权距离\n- RAD: 径向公路可达性指数\n- TAX: 每10,000美元的全值财产税率\n- PTRATIO: 城镇师生比例\n- B: 1000(Bk - 0.63)^2，其中Bk是城镇黑人比例\n- LSTAT: 低地位人口百分比\n\n数据形状: (506, 14)\n\n特征名称: ['CRIM', 'ZN', 'INDUS', 'CHAS', 'NOX', 'RM', 'AGE', 'DIS', 'RAD', 'TAX', 'PTRATIO', 'B', 'LSTAT']\n\n目标变量: MEDV (房价，单位：千美元)\n\n数据预览:\n      CRIM    ZN  INDUS  CHAS    NOX     RM   AGE     DIS  RAD    TAX  \\\n0  0.00632  18.0   2.31   0.0  0.538  6.575  65.2  4.0900  1.0  296.0   \n1  0.02731   0.0   7.07   0.0  0.469  6.421  78.9  4.9671  2.0  242.0   \n2  0.02729   0.0   7.07   0.0  0.469  7.185  61.1  4.9671  2.0  242.0   \n3  0.03237   0.0   2.18   0.0  0.458  6.998  45.8  6.0622  3.0  222.0   \n4  0.06905   0.0   2.18   0.0  0.458  7.147  54.2  6.0622  3.0  222.0   \n\n   PTRATIO       B  LSTAT  MEDV  \n0     15.3  396.90   4.98  24.0  \n1     17.8  396.90   9.14  21.6  \n2     17.8  392.83   4.03  34.7  \n3     18.7  394.63   2.94  33.4  \n4     18.7  396.90   5.33  36.2  \n\n数据信息:\n<class 'pandas.core.frame.DataFrame'>\nRangeIndex: 506 entries, 0 to 505\nData columns (total 14 columns):\n #   Column   Non-Null Count  Dtype  \n---  ------   --------------  -----  \n 0   CRIM     506 non-null    float64\n 1   ZN       506 non-null    float64\n 2   INDUS    506 non-null    float64\n 3   CHAS     506 non-null    float64\n 4   NOX      506 non-null    float64\n 5   RM       506 non-null    float64\n 6   AGE      506 non-null    float64\n 7   DIS      506 non-null    float64\n 8   RAD      506 non-null    float64\n 9   TAX      506 non-null    float64\n 10  PTRATIO  506 non-null    float64\n 11  B        506 non-null    float64\n 12  LSTAT    506 non-null    float64\n 13  MEDV     506 non-null    float64\ndtypes: float64(14)\nmemory usage: 55.5 KB\nNone\n\n数据统计:\n             CRIM          ZN       INDUS        CHAS         NOX          RM  \\\ncount  506.000000  506.000000  506.000000  506.000000  506.000000  506.000000   \nmean     3.613524   11.363636   11.136779    0.069170    0.554695    6.284634   \nstd      8.601545   23.322453    6.860353    0.253994    0.115878    0.702617   \nmin      0.006320    0.000000    0.460000    0.000000    0.385000    3.561000   \n25%      0.082045    0.000000    5.190000    0.000000    0.449000    5.885500   \n50%      0.256510    0.000000    9.690000    0.000000    0.538000    6.208500   \n75%      3.677083   12.500000   18.100000    0.000000    0.624000    6.623500   \nmax     88.976200  100.000000   27.740000    1.000000    0.871000    8.780000   \n\n              AGE         DIS         RAD         TAX     PTRATIO           B  \\\ncount  506.000000  506.000000  506.000000  506.000000  506.000000  506.000000   \nmean    68.574901    3.795043    9.549407  408.237154   18.455534  356.674032   \nstd     28.148861    2.105710    8.707259  168.537116    2.164946   91.294864   \nmin      2.900000    1.129600    1.000000  187.000000   12.600000    0.320000   \n25%     45.025000    2.100175    4.000000  279.000000   17.400000  375.377500   \n50%     77.500000    3.207450    5.000000  330.000000   19.050000  391.440000   \n75%     94.075000    5.188425   24.000000  666.000000   20.200000  396.225000   \nmax    100.000000   12.126500   24.000000  711.000000   22.000000  396.900000   \n\n            LSTAT        MEDV  \ncount  506.000000  506.000000  \nmean    12.653063   22.532806  \nstd      7.141062    9.197104  \nmin      1.730000    5.000000  \n25%      6.950000   17.025000  \n50%     11.360000   21.200000  \n75%     16.955000   25.000000  \nmax     37.970000   50.000000  \n```\n:::\n:::\n\n\n## 缺失值检查\n\n::: {#07f31f2e .cell message='false' execution_count=4}\n``` {.python .cell-code}\n# 缺失值检查（Boston Housing 数据集通常没有缺失值）\nprint('缺失值统计:')\nprint(df.isnull().sum())\nprint(f\"\\n总缺失值数量: {df.isnull().sum().sum()}\")\nprint(\"Boston Housing 数据集通常没有缺失值，无需额外处理\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n缺失值统计:\nCRIM       0\nZN         0\nINDUS      0\nCHAS       0\nNOX        0\nRM         0\nAGE        0\nDIS        0\nRAD        0\nTAX        0\nPTRATIO    0\nB          0\nLSTAT      0\nMEDV       0\ndtype: int64\n\n总缺失值数量: 0\nBoston Housing 数据集通常没有缺失值，无需额外处理\n```\n:::\n:::\n\n\n## 异常值检测\n\n::: {#c5798343 .cell message='false' execution_count=5}\n``` {.python .cell-code}\n# 异常值可视化与简单检测（以房价为例）\nfig, ax = plt.subplots(1, 2, figsize=(10, 4))\ndf.boxplot(column=['MEDV'], ax=ax[0])\nax[0].set_title('房价箱线图')\nax[1].scatter(df['RM'], df['MEDV'], s=10)\nax[1].set_xlabel('平均房间数')\nax[1].set_ylabel('房价（千美元）')\nax[1].set_title('房间数 vs 房价')\nplt.tight_layout(); plt.show()\n\nQ1 = df['MEDV'].quantile(0.25)\nQ3 = df['MEDV'].quantile(0.75)\nIQR = Q3 - Q1\noutliers = df[(df['MEDV'] < Q1 - 1.5*IQR) | (df['MEDV'] > Q3 + 1.5*IQR)]\nprint(f\"房价异常值数量: {len(outliers)}\")\n```\n\n::: {.cell-output .cell-output-display}\n![](w2_practice_files/figure-html/cell-6-output-1.png){width=950 height=377}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n房价异常值数量: 40\n```\n:::\n:::\n\n\n## 数据可视化\n\n::: {#32713f74 .cell message='false' execution_count=6}\n``` {.python .cell-code}\n# 可视化：散点图、直方图、相关矩阵\nsns.scatterplot(data=df, x='RM', y='MEDV')\nplt.title('房间数 vs 房价'); plt.show()\n\nfig, axes = plt.subplots(2, 2, figsize=(10, 8))\ndf['RM'].hist(ax=axes[0,0], bins=30); axes[0,0].set_title('房间数分布')\ndf['AGE'].hist(ax=axes[0,1], bins=30); axes[0,1].set_title('房龄分布')\ndf['CRIM'].hist(ax=axes[1,0], bins=30); axes[1,0].set_title('犯罪率分布')\ndf['MEDV'].hist(ax=axes[1,1], bins=30); axes[1,1].set_title('房价分布')\nplt.tight_layout(); plt.show()\n\ncorr = df.corr(numeric_only=True)\nplt.figure(figsize=(12,10))\nsns.heatmap(corr, annot=True, cmap='coolwarm', center=0, fmt='.2f')\nplt.title('相关系数热力图'); plt.show()\n\nprint('与房价的相关系数：')\nprint(corr['MEDV'].sort_values(ascending=False))\n```\n\n::: {.cell-output .cell-output-display}\n![](w2_practice_files/figure-html/cell-7-output-1.png){width=579 height=448}\n:::\n\n::: {.cell-output .cell-output-display}\n![](w2_practice_files/figure-html/cell-7-output-2.png){width=950 height=760}\n:::\n\n::: {.cell-output .cell-output-display}\n![](w2_practice_files/figure-html/cell-7-output-3.png){width=865 height=801}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n与房价的相关系数：\nMEDV       1.000000\nRM         0.695360\nZN         0.360445\nB          0.333461\nDIS        0.249929\nCHAS       0.175260\nAGE       -0.376955\nRAD       -0.381626\nCRIM      -0.388305\nNOX       -0.427321\nTAX       -0.468536\nINDUS     -0.483725\nPTRATIO   -0.507787\nLSTAT     -0.737663\nName: MEDV, dtype: float64\n```\n:::\n:::\n\n\n## 线性回归模型训练与评估\n\n::: {#b019a63d .cell message='false' execution_count=7}\n``` {.python .cell-code}\n# 训练线性回归并评估（MAE/RMSE）\nfeatures = ['RM', 'AGE', 'CRIM']  # 房间数、房龄、犯罪率\nX = df[features]\ny = df['MEDV']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)\nmodel = LinearRegression()\nmodel.fit(X_train, y_train)\n\ny_train_pred = model.predict(X_train)\ny_test_pred = model.predict(X_test)\n\nmae_train = mean_absolute_error(y_train, y_train_pred)\nmae_test = mean_absolute_error(y_test, y_test_pred)\nrmse_train = np.sqrt(mean_squared_error(y_train, y_train_pred))\nrmse_test = np.sqrt(mean_squared_error(y_test, y_test_pred))\n\nprint(f\"训练集 MAE: {mae_train:.2f} 千美元, RMSE: {rmse_train:.2f} 千美元\")\nprint(f\"测试集 MAE: {mae_test:.2f} 千美元, RMSE: {rmse_test:.2f} 千美元\")\nprint('系数:')\nfor name, coef in zip(features, model.coef_):\n    print(f\"  {name}: {coef:.3f}\")\nprint('截距:', round(model.intercept_, 3))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n训练集 MAE: 3.96 千美元, RMSE: 6.04 千美元\n测试集 MAE: 3.96 千美元, RMSE: 6.22 千美元\n系数:\n  RM: 8.427\n  AGE: -0.045\n  CRIM: -0.217\n截距: -26.532\n```\n:::\n:::\n\n\n## 残差分析\n\n::: {#76d0d10b .cell message='false' execution_count=8}\n``` {.python .cell-code}\n# 残差分析\nresiduals = y_test - y_test_pred\nplt.figure(figsize=(10,4))\nplt.subplot(1,2,1)\nplt.scatter(y_test_pred, residuals, s=12)\nplt.axhline(0, color='red', linestyle='--')\nplt.xlabel('预测值'); plt.ylabel('残差'); plt.title('残差图')\n\nplt.subplot(1,2,2)\nplt.hist(residuals, bins=30, edgecolor='black')\nplt.title('残差分布')\nplt.tight_layout(); plt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](w2_practice_files/figure-html/cell-9-output-1.png){width=951 height=377}\n:::\n:::\n\n\n## 总结与实战经验\n\n**本周学习的核心内容：**\n\n1. **数据处理基础**\n   - Pandas 数据读取与探索（head, info, describe）\n   - 缺失值处理策略（删除 vs 填充）\n   - 异常值检测与处理（箱线图、IQR 方法）\n\n2. **数据可视化**\n   - 散点图：观察变量间关系\n   - 直方图：了解数据分布\n   - 箱线图：识别异常值\n   - 相关矩阵热力图：发现特征间的相关性\n\n3. **线性回归模型**\n   - 模型训练：使用 sklearn 的 LinearRegression\n   - 评估指标：MAE（平均绝对误差）和 RMSE（均方根误差）\n   - 模型解释：系数和截距的含义\n\n4. **模型诊断**\n   - 残差分析：检查模型假设\n   - 残差图：识别非线性关系\n   - 残差分布：检验正态性假设\n\n**实战经验：**\n\n- ✅ **数据清洗是第一步**：缺失值和异常值会严重影响模型性能\n- ✅ **可视化很重要**：图表能帮我们发现数据中的模式和问题\n- ✅ **理解评估指标**：MAE 和 RMSE 有不同的业务含义，需要根据场景选择\n- ✅ **模型诊断不能忽略**：残差分析帮助我们理解模型的局限性\n- ✅ **特征选择很重要**：多特征模型不一定比单特征模型好，需要实际验证\n\n",
    "supporting": [
      "w2_practice_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}