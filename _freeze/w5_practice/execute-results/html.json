{
  "hash": "092fc1f4ba7566fb6adf709c3f0101d0",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: ç¬¬äº”è®²ä¸Šæœºå®è·µ\n---\n\n\n\næœ¬ä¸Šæœºè®²ä¹‰è¦†ç›–ä»¥ä¸‹å†…å®¹ï¼š\n\n- è¯»å– Titanic é¢„å¤„ç†åçš„æ•°æ®\n- éšæœºæ£®æ—æ¨¡å‹è®­ç»ƒä¸è¶…å‚æ•°è°ƒä¼˜\n- GBDTï¼ˆLightGBMï¼‰æ¨¡å‹è®­ç»ƒä¸è¶…å‚æ•°è°ƒä¼˜\n- ä¸‰æ¨¡å‹å¯¹æ¯”ï¼šå†³ç­–æ ‘ vs éšæœºæ£®æ— vs GBDT\n\n**å­¦ä¹ ç›®æ ‡**ï¼š\n\n- ç†è§£éšæœºæ£®æ—çš„å·¥ä½œåŸç†å’Œä¼˜åŠ¿\n- æŒæ¡ GBDTï¼ˆæ¢¯åº¦æå‡æ ‘ï¼‰çš„åŸºæœ¬æ¦‚å¿µ\n- å­¦ä¼šä½¿ç”¨ GridSearchCV è¿›è¡Œè¶…å‚æ•°è°ƒä¼˜\n- æ¯”è¾ƒä¸åŒé›†æˆå­¦ä¹ æ–¹æ³•çš„æ€§èƒ½\n\n**æ•°æ®æ¥æº**ï¼š`titanic_data/features_processed.csv` å’Œ `titanic_data/labels_processed.csv`ï¼ˆæ¥è‡ª W4 çš„é¢„å¤„ç†ç»“æœï¼‰\n\n::: {#1c77812c .cell message='false' execution_count=2}\n``` {.python .cell-code}\n# å¯¼å…¥æ‰€éœ€åº“\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport pickle\n\nfrom sklearn.model_selection import train_test_split, GridSearchCV, cross_val_score\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.metrics import (accuracy_score, precision_score, recall_score, f1_score,\n                             roc_auc_score, roc_curve, auc, classification_report)\n\nimport lightgbm as lgb\n```\n:::\n\n\n## æ•°æ®å‡†å¤‡\n\n**è¯´æ˜**ï¼šæˆ‘ä»¬ä½¿ç”¨ W3 é¢„å¤„ç†åçš„æ•°æ®ï¼Œç›´æ¥åŠ è½½å³å¯ã€‚æ•°æ®å·²ç»å®Œæˆï¼š\n\n- ç¼ºå¤±å€¼å¤„ç†\n- ç‰¹å¾ç¼–ç ï¼ˆSex æ ‡ç­¾ç¼–ç ï¼ŒEmbarked ç‹¬çƒ­ç¼–ç ï¼‰\n- ç‰¹å¾é€‰æ‹©\n\n**æ³¨æ„**ï¼šæ•°æ®åˆ†å‰²çš„ random_state éœ€è¦ä¸ W3 ä¿æŒä¸€è‡´ï¼ˆrandom_state=42ï¼‰ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨ç›¸åŒçš„æµ‹è¯•é›†è¿›è¡Œå…¬å¹³å¯¹æ¯”ã€‚\n\n::: {#8923836e .cell message='false' execution_count=3}\n``` {.python .cell-code}\n# è¯»å– W4 é¢„å¤„ç†åçš„æ•°æ®\nX = pd.read_csv('titanic_data/features_processed.csv')\ny = pd.read_csv('titanic_data/labels_processed.csv')\n\n# æ•°æ®åˆ†å‰²ï¼ˆä¸ W4 ä¿æŒä¸€è‡´ï¼‰\nX_train, X_test, y_train, y_test = train_test_split(\n    X, y, test_size=0.2, random_state=42, stratify=y\n)\n\nprint(f\"è®­ç»ƒé›†å½¢çŠ¶: {X_train.shape}\")\nprint(f\"æµ‹è¯•é›†å½¢çŠ¶: {X_test.shape}\")\nprint(f\"ç‰¹å¾åˆ—è¡¨: {list(X.columns)}\")\nprint(f\"è®­ç»ƒé›†å­˜æ´»ç‡: {y_train.mean().values[0]:.3f}\")\nprint(f\"æµ‹è¯•é›†å­˜æ´»ç‡: {y_test.mean().values[0]:.3f}\")\n\n# åŠ è½½ W4 çš„å†³ç­–æ ‘æ¨¡å‹å’Œç»“æœ\ntry:\n    with open('titanic_results/dt_model_w4.pkl', 'rb') as f:\n        dt_model_w4 = pickle.load(f)\n    with open('titanic_results/dt_results_w4.pkl', 'rb') as f:\n        dt_results_w4 = pickle.load(f)\n    print(\"\\nâœ… æˆåŠŸåŠ è½½ W4 çš„å†³ç­–æ ‘æ¨¡å‹å’Œç»“æœ\")\nexcept FileNotFoundError:\n    print(\"\\nâš ï¸  æœªæ‰¾åˆ° W4 çš„æ¨¡å‹æ–‡ä»¶ï¼Œå°†åœ¨åç»­é‡æ–°è®­ç»ƒå†³ç­–æ ‘\")\n    dt_model_w4 = None\n    dt_results_w4 = None\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nè®­ç»ƒé›†å½¢çŠ¶: (711, 8)\næµ‹è¯•é›†å½¢çŠ¶: (178, 8)\nç‰¹å¾åˆ—è¡¨: ['Pclass', 'Sex', 'Age', 'SibSp', 'Parch', 'Fare', 'Embarked_Q', 'Embarked_S']\nè®­ç»ƒé›†å­˜æ´»ç‡: 0.383\næµ‹è¯•é›†å­˜æ´»ç‡: 0.382\n\nâœ… æˆåŠŸåŠ è½½ W4 çš„å†³ç­–æ ‘æ¨¡å‹å’Œç»“æœ\n```\n:::\n:::\n\n\n## éšæœºæ£®æ—æ¨¡å‹è®­ç»ƒä¸è¶…å‚æ•°è°ƒä¼˜\n\n**éšæœºæ£®æ—ç®€ä»‹**ï¼š\n\néšæœºæ£®æ—æ˜¯ä¸€ç§é›†æˆå­¦ä¹ æ–¹æ³•ï¼Œé€šè¿‡ç»„åˆå¤šä¸ªå†³ç­–æ ‘æ¥æå‡é¢„æµ‹æ€§èƒ½ï¼š\n\n- **Baggingï¼ˆè‡ªåŠ©é‡‡æ ·ï¼‰**ï¼šæ¯ä¸ªæ ‘ä½¿ç”¨ä¸åŒçš„è®­ç»ƒå­é›†\n- **ç‰¹å¾éšæœºæ€§**ï¼šæ¯ä¸ªåˆ†è£‚æ—¶éšæœºé€‰æ‹©éƒ¨åˆ†ç‰¹å¾\n- **ä¼˜åŠ¿**ï¼šå‡å°‘è¿‡æ‹Ÿåˆï¼Œæé«˜æ³›åŒ–èƒ½åŠ›\n\n**ä¸»è¦è¶…å‚æ•°**ï¼š\n\n- **n_estimators**ï¼šæ£®æ—ä¸­æ ‘çš„æ•°é‡ï¼ˆè¶Šå¤šè¶Šå¥½ï¼Œä½†è®¡ç®—æˆæœ¬å¢åŠ ï¼‰\n- **max_depth**ï¼šæ¯æ£µæ ‘çš„æœ€å¤§æ·±åº¦\n- **min_samples_split**ï¼šåˆ†è£‚å†…éƒ¨èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ ·æœ¬æ•°\n- **min_samples_leaf**ï¼šå¶èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ ·æœ¬æ•°\n- **max_features**ï¼šå¯»æ‰¾æœ€ä½³åˆ†è£‚æ—¶è€ƒè™‘çš„ç‰¹å¾æ•°é‡\n\n::: {#80093006 .cell message='false' execution_count=4}\n``` {.python .cell-code}\n# éšæœºæ£®æ—ï¼šè¶…å‚æ•°è°ƒä¼˜ï¼ˆä½¿ç”¨ GridSearchCVï¼‰\nprint(\"\\n\" + \"=\" * 60)\nprint(\"éšæœºæ£®æ—è¶…å‚æ•°è°ƒä¼˜\")\nprint(\"=\" * 60)\n\n# å®šä¹‰å‚æ•°ç½‘æ ¼\nparam_grid_rf = {\n    'n_estimators': [50, 100, 200],\n    'max_depth': [5, 10, None],\n    'min_samples_split': [2, 5, 10],\n    'min_samples_leaf': [1, 2, 4],\n    'max_features': ['sqrt', 'log2']\n}\n\n# ä½¿ç”¨ GridSearchCV è¿›è¡Œç½‘æ ¼æœç´¢\nrf_model = RandomForestClassifier(random_state=42)\nrf_grid = GridSearchCV(\n    rf_model,\n    param_grid_rf,\n    cv=5,\n    scoring='roc_auc',\n    n_jobs=-1,\n    verbose=1\n)\n\nprint(\"\\nå¼€å§‹ç½‘æ ¼æœç´¢...\")\nrf_grid.fit(X_train, y_train)\n\nprint(f\"\\nâœ… éšæœºæ£®æ—æœ€ä½³å‚æ•°: {rf_grid.best_params_}\")\nprint(f\"âœ… æœ€ä½³äº¤å‰éªŒè¯ AUC: {rf_grid.best_score_:.4f}\")\n\n# ä½¿ç”¨æœ€ä½³å‚æ•°è®­ç»ƒæœ€ç»ˆæ¨¡å‹\nrf_best = rf_grid.best_estimator_\n\n# åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°\ny_pred_rf = rf_best.predict(X_test)\ny_prob_rf = rf_best.predict_proba(X_test)[:, 1]\n\nrf_accuracy = accuracy_score(y_test, y_pred_rf)\nrf_precision = precision_score(y_test, y_pred_rf)\nrf_recall = recall_score(y_test, y_pred_rf)\nrf_f1 = f1_score(y_test, y_pred_rf)\nrf_auc = roc_auc_score(y_test, y_prob_rf)\n\nprint(f\"\\nğŸ“Š éšæœºæ£®æ—æµ‹è¯•é›†æ€§èƒ½:\")\nprint(f\"  å‡†ç¡®ç‡: {rf_accuracy:.4f}\")\nprint(f\"  ç²¾ç¡®ç‡: {rf_precision:.4f}\")\nprint(f\"  å¬å›ç‡: {rf_recall:.4f}\")\nprint(f\"  F1åˆ†æ•°: {rf_f1:.4f}\")\nprint(f\"  AUC: {rf_auc:.4f}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\néšæœºæ£®æ—è¶…å‚æ•°è°ƒä¼˜\n============================================================\n\nå¼€å§‹ç½‘æ ¼æœç´¢...\nFitting 5 folds for each of 162 candidates, totalling 810 fits\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nâœ… éšæœºæ£®æ—æœ€ä½³å‚æ•°: {'max_depth': 10, 'max_features': 'log2', 'min_samples_leaf': 4, 'min_samples_split': 10, 'n_estimators': 200}\nâœ… æœ€ä½³äº¤å‰éªŒè¯ AUC: 0.8782\n\nğŸ“Š éšæœºæ£®æ—æµ‹è¯•é›†æ€§èƒ½:\n  å‡†ç¡®ç‡: 0.8146\n  ç²¾ç¡®ç‡: 0.8182\n  å¬å›ç‡: 0.6618\n  F1åˆ†æ•°: 0.7317\n  AUC: 0.8402\n```\n:::\n:::\n\n\n::: {#caa43370 .cell message='false' execution_count=5}\n``` {.python .cell-code}\n# éšæœºæ£®æ—ï¼šç‰¹å¾é‡è¦æ€§å¯è§†åŒ–\nimportances_rf = rf_best.feature_importances_\nindices_rf = np.argsort(importances_rf)[::-1]\n\nplt.figure(figsize=(10, 6))\nplt.barh(range(len(importances_rf)), importances_rf[indices_rf], color='skyblue')\nplt.yticks(range(len(importances_rf)), [X.columns[i] for i in indices_rf])\nplt.xlabel('ç‰¹å¾é‡è¦æ€§', fontsize=12)\nplt.title('éšæœºæ£®æ—ç‰¹å¾é‡è¦æ€§æ’åº', fontsize=14)\nplt.gca().invert_yaxis()  # æœ€é‡è¦çš„åœ¨é¡¶éƒ¨\nplt.grid(axis='x', alpha=0.3)\nplt.tight_layout()\nplt.show()\n\n# æ‰“å°ç‰¹å¾é‡è¦æ€§\nprint(\"\\néšæœºæ£®æ—ç‰¹å¾é‡è¦æ€§ï¼ˆä»é«˜åˆ°ä½ï¼‰:\")\nfor i in indices_rf:\n    print(f\"  {X.columns[i]}: {importances_rf[i]:.4f}\")\n```\n\n::: {.cell-output .cell-output-display}\n![](w5_practice_files/figure-html/cell-6-output-1.png){width=950 height=566}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\néšæœºæ£®æ—ç‰¹å¾é‡è¦æ€§ï¼ˆä»é«˜åˆ°ä½ï¼‰:\n  Sex: 0.4155\n  Fare: 0.2227\n  Age: 0.1399\n  Pclass: 0.1089\n  SibSp: 0.0461\n  Parch: 0.0273\n  Embarked_S: 0.0239\n  Embarked_Q: 0.0158\n```\n:::\n:::\n\n\n## GBDTï¼ˆLightGBMï¼‰æ¨¡å‹è®­ç»ƒä¸è¶…å‚æ•°è°ƒä¼˜\n\n**GBDTï¼ˆæ¢¯åº¦æå‡å†³ç­–æ ‘ï¼‰ç®€ä»‹**ï¼š\n\nGBDT æ˜¯ä¸€ç§å¼ºå¤§çš„é›†æˆå­¦ä¹ æ–¹æ³•ï¼Œé€šè¿‡é€æ­¥ä¿®æ­£å‰ä¸€è½®çš„é”™è¯¯æ¥æå‡æ€§èƒ½ï¼š\n\n- **Boostingï¼ˆæå‡ï¼‰**ï¼šå¼±å­¦ä¹ å™¨é€æ­¥æ”¹è¿›\n- **æ¢¯åº¦ä¸‹é™**ï¼šä½¿ç”¨æ¢¯åº¦ä¿¡æ¯ä¼˜åŒ–æŸå¤±å‡½æ•°\n- **LightGBM ä¼˜åŠ¿**ï¼šé€Ÿåº¦å¿«ã€å†…å­˜æ•ˆç‡é«˜ï¼Œæ”¯æŒå¤§è§„æ¨¡æ•°æ®\n\n**ä¸»è¦è¶…å‚æ•°**ï¼š\n\n- **n_estimators**ï¼šæå‡è½®æ•°\n- **learning_rate**ï¼šå­¦ä¹ ç‡ï¼ˆæ§åˆ¶æ¯è½®çš„å½±å“ï¼‰\n- **max_depth**ï¼šæ ‘çš„æœ€å¤§æ·±åº¦\n- **num_leaves**ï¼šå¶å­èŠ‚ç‚¹æ•°é‡ï¼ˆLightGBM ç‰¹æœ‰ï¼‰\n- **min_child_samples**ï¼šå¶èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°\n\n**è¶…å‚æ•°è°ƒä¼˜ç­–ç•¥**ï¼š\n\nå‚è€ƒ `lab03_titanic.py`ï¼Œæˆ‘ä»¬ä½¿ç”¨ GridSearchCV è¿›è¡Œç½‘æ ¼æœç´¢ï¼š\n\n- **n_estimators**ï¼šæ ‘çš„æ•°é‡\n- **learning_rate**ï¼šå­¦ä¹ ç‡ï¼ˆæ§åˆ¶æ¯æ£µæ ‘çš„å½±å“ï¼‰\n- **max_depth**ï¼šæ ‘çš„æœ€å¤§æ·±åº¦\n- **num_leaves**ï¼šå¶å­èŠ‚ç‚¹æ•°é‡ï¼ˆLightGBM ç‰¹æœ‰ï¼‰\n- **min_child_samples**ï¼šå¶èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°\n\n::: {#f269be6d .cell message='false' execution_count=6}\n``` {.python .cell-code}\n# GBDTï¼ˆLightGBMï¼‰ï¼šè¶…å‚æ•°è°ƒä¼˜ï¼ˆä½¿ç”¨ GridSearchCVï¼‰\nprint(\"\\n\" + \"=\" * 60)\nprint(\"GBDT (LightGBM) è¶…å‚æ•°è°ƒä¼˜\")\nprint(\"=\" * 60)\n\n# å®šä¹‰å‚æ•°ç½‘æ ¼ï¼ˆå‚è€ƒ lab03_titanic.py ä¸­çš„ XGBoost è°ƒå‚ï¼‰\nparam_grid_gbm = {\n    'n_estimators': [50, 100, 200],\n    'learning_rate': [0.01, 0.05, 0.1, 0.2],\n    'max_depth': [3, 5, 7],\n    'num_leaves': [15, 31, 63],  # LightGBM ç‰¹æœ‰å‚æ•°\n    'min_child_samples': [10, 20, 30]\n}\n\n# ä½¿ç”¨ GridSearchCV è¿›è¡Œç½‘æ ¼æœç´¢\ngbm_model = lgb.LGBMClassifier(random_state=42, verbosity=-1)\ngbm_grid = GridSearchCV(\n    gbm_model,\n    param_grid_gbm,\n    cv=5,\n    scoring='roc_auc',\n    n_jobs=-1,\n    verbose=1\n)\n\nprint(\"\\nå¼€å§‹ç½‘æ ¼æœç´¢...\")\ngbm_grid.fit(X_train, y_train)\n\nprint(f\"\\nâœ… GBDT æœ€ä½³å‚æ•°: {gbm_grid.best_params_}\")\nprint(f\"âœ… æœ€ä½³äº¤å‰éªŒè¯ AUC: {gbm_grid.best_score_:.4f}\")\n\n# ä½¿ç”¨æœ€ä½³å‚æ•°è®­ç»ƒæœ€ç»ˆæ¨¡å‹\ngbm_best = gbm_grid.best_estimator_\n\n# åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°\ny_pred_gbm = gbm_best.predict(X_test)\ny_prob_gbm = gbm_best.predict_proba(X_test)[:, 1]\n\ngbm_accuracy = accuracy_score(y_test, y_pred_gbm)\ngbm_precision = precision_score(y_test, y_pred_gbm)\ngbm_recall = recall_score(y_test, y_pred_gbm)\ngbm_f1 = f1_score(y_test, y_pred_gbm)\ngbm_auc = roc_auc_score(y_test, y_prob_gbm)\n\nprint(f\"\\nğŸ“Š GBDT æµ‹è¯•é›†æ€§èƒ½:\")\nprint(f\"  å‡†ç¡®ç‡: {gbm_accuracy:.4f}\")\nprint(f\"  ç²¾ç¡®ç‡: {gbm_precision:.4f}\")\nprint(f\"  å¬å›ç‡: {gbm_recall:.4f}\")\nprint(f\"  F1åˆ†æ•°: {gbm_f1:.4f}\")\nprint(f\"  AUC: {gbm_auc:.4f}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\nGBDT (LightGBM) è¶…å‚æ•°è°ƒä¼˜\n============================================================\n\nå¼€å§‹ç½‘æ ¼æœç´¢...\nFitting 5 folds for each of 324 candidates, totalling 1620 fits\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nâœ… GBDT æœ€ä½³å‚æ•°: {'learning_rate': 0.01, 'max_depth': 7, 'min_child_samples': 10, 'n_estimators': 200, 'num_leaves': 31}\nâœ… æœ€ä½³äº¤å‰éªŒè¯ AUC: 0.8794\n\nğŸ“Š GBDT æµ‹è¯•é›†æ€§èƒ½:\n  å‡†ç¡®ç‡: 0.8315\n  ç²¾ç¡®ç‡: 0.8519\n  å¬å›ç‡: 0.6765\n  F1åˆ†æ•°: 0.7541\n  AUC: 0.8375\n```\n:::\n:::\n\n\n::: {#60fbb63d .cell message='false' execution_count=7}\n``` {.python .cell-code}\n# GBDTï¼šç‰¹å¾é‡è¦æ€§å¯è§†åŒ–\nimportances_gbm = gbm_best.feature_importances_\nindices_gbm = np.argsort(importances_gbm)[::-1]\n\nplt.figure(figsize=(10, 6))\nplt.barh(range(len(importances_gbm)), importances_gbm[indices_gbm], color='lightgreen')\nplt.yticks(range(len(importances_gbm)), [X.columns[i] for i in indices_gbm])\nplt.xlabel('ç‰¹å¾é‡è¦æ€§', fontsize=12)\nplt.title('GBDT (LightGBM) ç‰¹å¾é‡è¦æ€§æ’åº', fontsize=14)\nplt.gca().invert_yaxis()  # æœ€é‡è¦çš„åœ¨é¡¶éƒ¨\nplt.grid(axis='x', alpha=0.3)\nplt.tight_layout()\nplt.show()\n\n# æ‰“å°ç‰¹å¾é‡è¦æ€§\nprint(\"\\nGBDT ç‰¹å¾é‡è¦æ€§ï¼ˆä»é«˜åˆ°ä½ï¼‰:\")\nfor i in indices_gbm:\n    print(f\"  {X.columns[i]}: {importances_gbm[i]:.4f}\")\n```\n\n::: {.cell-output .cell-output-display}\n![](w5_practice_files/figure-html/cell-8-output-1.png){width=950 height=567}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nGBDT ç‰¹å¾é‡è¦æ€§ï¼ˆä»é«˜åˆ°ä½ï¼‰:\n  Fare: 2297.0000\n  Age: 1996.0000\n  SibSp: 399.0000\n  Parch: 329.0000\n  Pclass: 311.0000\n  Embarked_S: 253.0000\n  Sex: 200.0000\n  Embarked_Q: 96.0000\n```\n:::\n:::\n\n\n## ä¸‰æ¨¡å‹å¯¹æ¯”ï¼šå†³ç­–æ ‘ vs éšæœºæ£®æ— vs GBDT\n\n**å¯¹æ¯”è¯´æ˜**ï¼š\n\næˆ‘ä»¬å°†æ¯”è¾ƒä¸‰ä¸ªæ¨¡å‹çš„æ€§èƒ½ï¼š\n\n1. **å†³ç­–æ ‘**ï¼šæ¥è‡ª W3 çš„è®­ç»ƒç»“æœï¼ˆæˆ–é‡æ–°è¯„ä¼°ï¼‰\n2. **éšæœºæ£®æ—**ï¼šä½¿ç”¨ GridSearchCV æ‰¾åˆ°çš„æœ€ä½³å‚æ•°\n3. **GBDT (LightGBM)**ï¼šä½¿ç”¨ GridSearchCV æ‰¾åˆ°çš„æœ€ä½³å‚æ•°\n\n**å¯¹æ¯”æŒ‡æ ‡**ï¼š\n\n- å‡†ç¡®ç‡ (Accuracy)\n- ç²¾ç¡®ç‡ (Precision)\n- å¬å›ç‡ (Recall)\n- F1 åˆ†æ•°\n- AUCï¼ˆROC æ›²çº¿ä¸‹é¢ç§¯ï¼‰\n\n::: {#f0b2e4e2 .cell message='false' execution_count=8}\n``` {.python .cell-code}\n# ä¸‰æ¨¡å‹å¯¹æ¯”ï¼šå†³ç­–æ ‘ vs éšæœºæ£®æ— vs GBDT\nprint(\"\\n\" + \"=\" * 60)\nprint(\"ä¸‰æ¨¡å‹æ€§èƒ½å¯¹æ¯”\")\nprint(\"=\" * 60)\n\n# å¦‚æœ W4 çš„æ¨¡å‹å·²åŠ è½½ï¼Œä½¿ç”¨å…¶ç»“æœï¼›å¦åˆ™é‡æ–°è¯„ä¼°\nif dt_model_w4 is not None and dt_results_w4 is not None:\n    dt_accuracy = dt_results_w4['accuracy']\n    dt_precision = dt_results_w4['precision']\n    dt_recall = dt_results_w4['recall']\n    dt_f1 = dt_results_w4['f1']\n    dt_auc = dt_results_w4['roc_auc']\n    print(\"âœ… ä½¿ç”¨ W4 ä¿å­˜çš„å†³ç­–æ ‘ç»“æœ\")\nelse:\n    # é‡æ–°è¯„ä¼°å†³ç­–æ ‘ï¼ˆä½¿ç”¨ W4 çš„æœ€ä½³å‚æ•°æˆ–é»˜è®¤å‚æ•°ï¼‰\n    print(\"âš ï¸  é‡æ–°è®­ç»ƒå†³ç­–æ ‘...\")\n    dt_temp = DecisionTreeClassifier(max_depth=5, random_state=42)\n    dt_temp.fit(X_train, y_train)\n    y_pred_dt = dt_temp.predict(X_test)\n    y_prob_dt = dt_temp.predict_proba(X_test)[:, 1]\n    dt_accuracy = accuracy_score(y_test, y_pred_dt)\n    dt_precision = precision_score(y_test, y_pred_dt)\n    dt_recall = recall_score(y_test, y_pred_dt)\n    dt_f1 = f1_score(y_test, y_pred_dt)\n    dt_auc = roc_auc_score(y_test, y_prob_dt)\n\n# åˆ›å»ºå¯¹æ¯”è¡¨æ ¼\ncomparison_data = {\n    'æ¨¡å‹': ['å†³ç­–æ ‘', 'éšæœºæ£®æ—', 'GBDT (LightGBM)'],\n    'å‡†ç¡®ç‡': [dt_accuracy, rf_accuracy, gbm_accuracy],\n    'ç²¾ç¡®ç‡': [dt_precision, rf_precision, gbm_precision],\n    'å¬å›ç‡': [dt_recall, rf_recall, gbm_recall],\n    'F1åˆ†æ•°': [dt_f1, rf_f1, gbm_f1],\n    'AUC': [dt_auc, rf_auc, gbm_auc]\n}\n\ncomparison_df = pd.DataFrame(comparison_data)\nprint(\"\\nğŸ“Š æ¨¡å‹æ€§èƒ½å¯¹æ¯”è¡¨:\")\nprint(comparison_df.round(4))\n\n# å¯è§†åŒ–å¯¹æ¯”\nfig, axes = plt.subplots(2, 3, figsize=(18, 10))\n\nmetrics = ['å‡†ç¡®ç‡', 'ç²¾ç¡®ç‡', 'å¬å›ç‡', 'F1åˆ†æ•°', 'AUC']\ncolors = ['#3498db', '#2ecc71', '#e74c3c']\n\nfor i, metric in enumerate(metrics):\n    row = i // 3\n    col = i % 3\n    axes[row, col].bar(comparison_df['æ¨¡å‹'], comparison_df[metric], color=colors)\n    axes[row, col].set_title(f'{metric} å¯¹æ¯”', fontsize=12, fontweight='bold')\n    axes[row, col].set_ylabel(metric, fontsize=11)\n    axes[row, col].set_ylim([0, 1])\n    axes[row, col].grid(axis='y', alpha=0.3)\n    # æ·»åŠ æ•°å€¼æ ‡ç­¾\n    for j, v in enumerate(comparison_df[metric]):\n        axes[row, col].text(j, v + 0.01, f'{v:.3f}', ha='center', fontsize=10)\n\n# æœ€åä¸€ä¸ªå­å›¾ï¼šAUC å¯¹æ¯”ï¼ˆçªå‡ºæ˜¾ç¤ºï¼‰\naxes[1, 2].bar(comparison_df['æ¨¡å‹'], comparison_df['AUC'], color=colors)\naxes[1, 2].set_title('AUC å¯¹æ¯”ï¼ˆæ ¸å¿ƒæŒ‡æ ‡ï¼‰', fontsize=12, fontweight='bold')\naxes[1, 2].set_ylabel('AUC', fontsize=11)\naxes[1, 2].set_ylim([0.7, 1.0])\naxes[1, 2].grid(axis='y', alpha=0.3)\nfor j, v in enumerate(comparison_df['AUC']):\n    axes[1, 2].text(j, v + 0.01, f'{v:.4f}', ha='center', fontsize=10, fontweight='bold')\n\nplt.tight_layout()\nplt.show()\n\n# æ‰¾å‡ºæœ€ä½³æ¨¡å‹\nbest_auc_idx = comparison_df['AUC'].idxmax()\nbest_model = comparison_df.loc[best_auc_idx, 'æ¨¡å‹']\nprint(f\"\\nğŸ† æœ€ä½³æ¨¡å‹ï¼ˆæŒ‰ AUCï¼‰: {best_model}\")\nprint(f\"   AUC: {comparison_df.loc[best_auc_idx, 'AUC']:.4f}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n============================================================\nä¸‰æ¨¡å‹æ€§èƒ½å¯¹æ¯”\n============================================================\nâœ… ä½¿ç”¨ W4 ä¿å­˜çš„å†³ç­–æ ‘ç»“æœ\n\nğŸ“Š æ¨¡å‹æ€§èƒ½å¯¹æ¯”è¡¨:\n                æ¨¡å‹     å‡†ç¡®ç‡     ç²¾ç¡®ç‡     å¬å›ç‡    F1åˆ†æ•°     AUC\n0              å†³ç­–æ ‘  0.8090  0.8148  0.6471  0.7213  0.8560\n1             éšæœºæ£®æ—  0.8146  0.8182  0.6618  0.7317  0.8402\n2  GBDT (LightGBM)  0.8315  0.8519  0.6765  0.7541  0.8375\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](w5_practice_files/figure-html/cell-9-output-2.png){width=1717 height=951}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nğŸ† æœ€ä½³æ¨¡å‹ï¼ˆæŒ‰ AUCï¼‰: å†³ç­–æ ‘\n   AUC: 0.8560\n```\n:::\n:::\n\n\n::: {#0a57f960 .cell message='false' execution_count=9}\n``` {.python .cell-code}\n# ROC æ›²çº¿å¯¹æ¯”\n# è·å–å„æ¨¡å‹çš„é¢„æµ‹æ¦‚ç‡\nif dt_model_w4 is not None:\n    y_prob_dt = dt_model_w4.predict_proba(X_test)[:, 1]\nelse:\n    dt_temp = DecisionTreeClassifier(max_depth=5, random_state=42)\n    dt_temp.fit(X_train, y_train)\n    y_prob_dt = dt_temp.predict_proba(X_test)[:, 1]\n\ny_prob_rf = rf_best.predict_proba(X_test)[:, 1]\ny_prob_gbm = gbm_best.predict_proba(X_test)[:, 1]\n\n# è®¡ç®— ROC æ›²çº¿\nfpr_dt, tpr_dt, _ = roc_curve(y_test, y_prob_dt)\nfpr_rf, tpr_rf, _ = roc_curve(y_test, y_prob_rf)\nfpr_gbm, tpr_gbm, _ = roc_curve(y_test, y_prob_gbm)\n\nauc_dt = auc(fpr_dt, tpr_dt)\nauc_rf = auc(fpr_rf, tpr_rf)\nauc_gbm = auc(fpr_gbm, tpr_gbm)\n\n# ç»˜åˆ¶ ROC æ›²çº¿\nplt.figure(figsize=(10, 8))\nplt.plot(fpr_dt, tpr_dt, color='#3498db', linewidth=2, label=f'å†³ç­–æ ‘ (AUC = {auc_dt:.4f})')\nplt.plot(fpr_rf, tpr_rf, color='#2ecc71', linewidth=2, label=f'éšæœºæ£®æ— (AUC = {auc_rf:.4f})')\nplt.plot(fpr_gbm, tpr_gbm, color='#e74c3c', linewidth=2, label=f'GBDT (AUC = {auc_gbm:.4f})')\nplt.plot([0, 1], [0, 1], color='navy', linewidth=2, linestyle='--', label='éšæœºçŒœæµ‹')\n\nplt.xlim([0.0, 1.0])\nplt.ylim([0.0, 1.05])\nplt.xlabel('å‡æ­£ä¾‹ç‡ (FPR)', fontsize=12)\nplt.ylabel('çœŸæ­£ä¾‹ç‡ (TPR)', fontsize=12)\nplt.title('ä¸‰æ¨¡å‹ ROC æ›²çº¿å¯¹æ¯”', fontsize=14, fontweight='bold')\nplt.legend(loc=\"lower right\", fontsize=11)\nplt.grid(True, alpha=0.3)\nplt.tight_layout()\nplt.show()\n\nprint(\"\\nROC æ›²çº¿å¯¹æ¯”åˆ†æ:\")\nprint(\"- AUC è¶Šæ¥è¿‘ 1.0ï¼Œæ¨¡å‹æ€§èƒ½è¶Šå¥½\")\nprint(\"- æ›²çº¿è¶Šé è¿‘å·¦ä¸Šè§’ï¼Œæ¨¡å‹æ€§èƒ½è¶Šå¥½\")\nprint(f\"- æœ€ä½³æ¨¡å‹: {best_model} (AUC = {comparison_df.loc[best_auc_idx, 'AUC']:.4f})\")\n```\n\n::: {.cell-output .cell-output-display}\n![](w5_practice_files/figure-html/cell-10-output-1.png){width=950 height=758}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nROC æ›²çº¿å¯¹æ¯”åˆ†æ:\n- AUC è¶Šæ¥è¿‘ 1.0ï¼Œæ¨¡å‹æ€§èƒ½è¶Šå¥½\n- æ›²çº¿è¶Šé è¿‘å·¦ä¸Šè§’ï¼Œæ¨¡å‹æ€§èƒ½è¶Šå¥½\n- æœ€ä½³æ¨¡å‹: å†³ç­–æ ‘ (AUC = 0.8560)\n```\n:::\n:::\n\n\n## æ€»ç»“ä¸å®æˆ˜ç»éªŒ\n\n**æœ¬æ¬¡è¯¾ç¨‹çš„æ ¸å¿ƒå†…å®¹ï¼š**\n\n1. **é›†æˆå­¦ä¹ æ–¹æ³•**\n   - **Baggingï¼ˆè£…è¢‹ï¼‰**ï¼šéšæœºæ£®æ—é€šè¿‡è‡ªåŠ©é‡‡æ ·å‡å°‘æ–¹å·®\n   - **Boostingï¼ˆæå‡ï¼‰**ï¼šGBDT é€šè¿‡é€æ­¥ä¿®æ­£é”™è¯¯æå‡æ€§èƒ½\n   - **ç‰¹å¾éšæœºæ€§**ï¼šéšæœºæ£®æ—åœ¨ç‰¹å¾é€‰æ‹©ä¸Šå¼•å…¥éšæœºæ€§\n\n2. **LightGBM ç‰¹æ€§**\n   - åŸºäºç›´æ–¹å›¾çš„ç®—æ³•ï¼Œè®­ç»ƒé€Ÿåº¦å¿«\n   - æ”¯æŒå¤§è§„æ¨¡æ•°æ®ï¼Œå†…å­˜æ•ˆç‡é«˜\n   - å†…ç½®ç‰¹å¾é‡è¦æ€§åˆ†æ\n\n3. **è¶…å‚æ•°è°ƒä¼˜**\n   - **GridSearchCV**ï¼šç³»ç»Ÿåœ°æœç´¢æœ€ä¼˜å‚æ•°ç»„åˆ\n   - **äº¤å‰éªŒè¯**ï¼šç¡®ä¿å‚æ•°é€‰æ‹©çš„å¯é æ€§\n   - **å¤šæŒ‡æ ‡è¯„ä¼°**ï¼šç»¼åˆè€ƒè™‘å‡†ç¡®ç‡ã€AUC ç­‰æŒ‡æ ‡\n\n4. **æ¨¡å‹å¯¹æ¯”åˆ†æ**\n   - é›†æˆæ–¹æ³•é€šå¸¸ä¼˜äºå•ä¸€å†³ç­–æ ‘\n   - ä¸åŒç®—æ³•å„æœ‰ä¼˜åŠ¿ï¼Œéœ€è¦æ ¹æ®æ•°æ®ç‰¹ç‚¹é€‰æ‹©\n   - å¯è§£é‡Šæ€§ vs é¢„æµ‹æ€§èƒ½çš„æƒè¡¡\n\n**é›†æˆå­¦ä¹ çš„å…³é”®ä¼˜åŠ¿ï¼š**\n\n- **å‡å°‘è¿‡æ‹Ÿåˆ**ï¼šé€šè¿‡ç»„åˆå¤šä¸ªæ¨¡å‹æé«˜æ³›åŒ–èƒ½åŠ›\n- **æå‡æ€§èƒ½**ï¼šé›†æˆæ–¹æ³•é€šå¸¸æ¯”å•ä¸€æ¨¡å‹è¡¨ç°æ›´å¥½\n- **é²æ£’æ€§å¼º**ï¼šå¯¹å¼‚å¸¸å€¼å’Œå™ªå£°æœ‰æ›´å¥½çš„æŠµæŠ—åŠ›\n\n**å®æˆ˜ç»éªŒæ€»ç»“ï¼š**\n\n- âœ… **é›†æˆæ–¹æ³•é€šå¸¸æ›´å¼ºå¤§**ï¼šéšæœºæ£®æ—å’Œ GBDT å¾€å¾€ä¼˜äºå•ä¸€å†³ç­–æ ‘\n- âœ… **GridSearchCV å¾ˆå®ç”¨**ï¼šç³»ç»Ÿåœ°æœç´¢æœ€ä¼˜å‚æ•°ï¼Œé¿å…æ‰‹åŠ¨è°ƒå‚çš„ç›²ç›®æ€§\n- âœ… **AUC ä½œä¸ºæ ¸å¿ƒæŒ‡æ ‡**ï¼šåœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼ŒAUC æ¯”å‡†ç¡®ç‡æ›´å¯é \n- âœ… **ç‰¹å¾é‡è¦æ€§æœ‰ä»·å€¼**ï¼šå¸®åŠ©ç†è§£æ¨¡å‹å†³ç­–é€»è¾‘ï¼Œæ”¯æŒç‰¹å¾å·¥ç¨‹\n- âœ… **è®¡ç®—æ•ˆç‡å¾ˆé‡è¦**ï¼šLightGBM åœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šè¡¨ç°ä¼˜ç§€\n- âœ… **æ¨¡å‹é€‰æ‹©è¦å› åœ°åˆ¶å®œ**ï¼šæ ¹æ®æ•°æ®è§„æ¨¡å’Œä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç®—æ³•\n\n",
    "supporting": [
      "w5_practice_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}