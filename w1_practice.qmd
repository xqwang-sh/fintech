---
title: 第一讲上机实践
---

```{python}
#| echo: false
import matplotlib.pyplot as plt
# 根据操作系统设置不同的字体
import platform

# 获取操作系统类型
system = platform.system()

# 设置 matplotlib 字体
if system == 'Windows':
    plt.rcParams['font.sans-serif'] = ['SimHei']  # Windows 使用黑体
elif system == 'Darwin':
    plt.rcParams['font.sans-serif'] = ['Songti SC']  # Mac 使用宋体
else:
    plt.rcParams['font.sans-serif'] = ['WenQuanYi Zen Hei']  # Linux 使用文泉驿正黑

# 解决负号显示问题
plt.rcParams['axes.unicode_minus'] = False

```

本上机讲义覆盖以下内容：

- 环境安装：Python、Jupyter、VS Code插件
- 安装验证：Python、Jupyter
- Python 基础：变量、列表、导入与函数调用
- 第一个机器学习程序：线性回归的简化体验

## 环境安装详细指南

### Python 安装

**推荐方式1：Python 官方安装包**

- 下载地址：https://www.python.org/downloads
- 选择最新稳定版本（建议 3.10）
- 安装时务必勾选 "Add Python to PATH"
- 验证安装：终端运行 `python --version`

**推荐方式2：Anaconda/Miniconda**

- 下载地址：https://www.anaconda.com/download
- 优点：预装常用科学计算库，环境管理方便
- 安装步骤：
  1. 下载对应操作系统的安装包
  2. 运行安装程序，选择"为所有用户安装"或"仅为我安装"
  3. 添加 Anaconda 到系统 PATH（安装时勾选）
  4. 验证安装：打开终端运行 `python --version`

### Jupyter 安装

**方式1：通过 pip 安装**

```bash
pip install jupyter
```

**方式2：通过 conda 安装（如果使用 Anaconda）**

```bash
conda install jupyter
```

**启动 Jupyter**

- Jupyter Notebook：终端运行 `jupyter notebook`
- JupyterLab：终端运行 `jupyter lab`
- 默认在浏览器中打开 http://localhost:8888

### VS Code 插件安装指南

如果使用 VS Code 进行编程，请安装以下必备插件：

1. **Python** (Microsoft官方插件)
   - 搜索并安装：`ms-python.python`
   - 提供 Python 语言支持、调试、代码格式化等功能

2. **Jupyter**
   - 搜索并安装：`ms-toolsai.jupyter`
   - 支持在 VS Code 中运行 .ipynb 文件

3. **Pylance**
   - 搜索并安装：`ms-python.pylance`
   - 提供更好的 Python 语言服务器，支持类型检查和智能提示

**安装步骤：**

1. 打开 VS Code
2. 按 `Ctrl+Shift+P` (Windows/Linux) 或 `Cmd+Shift+P` (Mac) 打开命令面板
3. 输入 `Extensions: Install Extensions`
4. 搜索上述插件名称并安装

按顺序运行每个单元格，遇到错误先读提示再求助助教。

```{python}
#| message: false
#| warning: false
# 验证 Python 与 Jupyter
import sys, subprocess
print('Python 版本:', sys.version)

# 安装常用库

# 方式1: 如果你用"官网方式"（pip）安装Python，可用如下命令安装常用库(终端/Anaconda Prompt 打开后运行)：
# pip install numpy pandas matplotlib scikit-learn

# 方式2: 如果你用Anaconda (conda) 安装Python，可用如下conda命令安装常用库：
# conda install numpy pandas matplotlib scikit-learn

# 方式3: 推荐现代方法 —— 使用 uv 管理包（更快、更安全！）
# 1. 用pip安装uv（只需一次）：
# pip install uv

# 2. 之后用uv代替pip安装常用库，命令和pip几乎完全一样，但速度更快、依赖解析更准确：
# uv pip install numpy pandas matplotlib scikit-learn

# 3. 对于零基础同学，使用 uv 安装包有几个优势：
# - 管理库更方便：只需一个命令即可一次性安装或更新多个库，不必手动一个个装。
# - 出错更少：uv 会自动帮你处理库之间的兼容关系，减少出现"库版本冲突"的问题。
# - 安装速度快：uv 下载和安装包通常比 pip 更快，能节省等待时间。
# - 后续维护简单：你还可以用 uv 快速导出/导入全部依赖，方便以后迁移或在新环境复现。
# 总结：uv 就像"自动帮你打理图书馆的管家"，让我们不用担心安装库的细节，把注意力集中在代码和实验本身，非常适合初学者用来管理项目依赖。

# 验证常用库是否可导入（若失败不报错，仅提示）
libs = ['numpy', 'pandas', 'matplotlib', 'sklearn']
for lib in libs:
    try:
        __import__(lib)
        print(f'{lib} 导入成功')
    except Exception as e:
        print(f'{lib} 导入失败：{e}\n可用 pip 安装：pip install {lib}')
```

### 如果库导入失败，如何安装？

**方式1：使用 pip 安装（如果使用官网 Python 安装包）**

```bash
pip install numpy pandas matplotlib scikit-learn
```

**方式2：使用 conda 安装（如果使用 Anaconda）**

```bash
conda install numpy pandas matplotlib scikit-learn
```

**方式3：使用国内镜像源（如果下载速度慢）**

```bash
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple numpy pandas matplotlib scikit-learn
```

**常见问题：**

- 如果提示 `pip 命令找不到`，尝试：`python -m pip install numpy pandas matplotlib scikit-learn`
- Mac 用户可能需要使用 `pip3` 而不是 `pip`

## 变量与基本运算

**什么是变量？** 变量就像是一个"盒子"，用来存储数据。给这个盒子起个名字，就可以随时使用里面的数据。

**Python 中的变量特点：**

- 不需要提前声明类型（Python 会自动识别）
- 变量名要清晰易懂（比如 `age` 而不是 `a`）
- 可以随时修改值

下面我们看看具体例子：

```{python}
#| message: false
#| warning: false
# 1. 变量赋值：创建变量并存储数据
age = 20          # 整数（int）：存储年龄
price = 50.5      # 浮点数（float）：存储价格，带小数
name = "Alice"    # 字符串（str）：存储文本，需要用引号

# 2. 打印变量：查看变量的值
print(age)
print(price)
print(name)

# 3. 基本运算：使用变量进行计算
area = 100              # 房屋面积（平米）
price_per_sqm = 5000   # 每平米价格（元）
total_price = area * price_per_sqm  # 计算总价
print("总价:", total_price)

# 4. 查看变量类型：了解变量存储的是什么类型的数据
print(type(age))       # <class 'int'> - 整数类型
print(type(price))     # <class 'float'> - 浮点数类型
print(type(name))      # <class 'str'> - 字符串类型
```

**练习题：** 创建变量 `house_area = 120` 与 `price_per_sqm = 8000`，计算总价并打印。

**提示：** 参考上面的代码，创建两个变量，然后用乘法计算总价。

## 列表

**什么是列表？** 列表就像是一个"容器"，可以存储多个数据。列表中的元素有顺序，可以用位置（索引）来访问。

**列表的特点：**

- 用方括号 `[]` 创建
- 元素之间用逗号分隔
- 索引从 0 开始（第一个元素是 `[0]`，第二个是 `[1]`）
- 可以用 `-1` 访问最后一个元素
- 可以随时添加、删除元素

下面我们学习列表的基本操作：

```{python}
#| message: false
#| warning: false
# 1. 创建列表：存储多个房价数据
house_prices = [100, 150, 200, 250, 300]

# 2. 访问列表元素：使用索引（位置）
print(house_prices[0])    # 第一个元素：100（索引从0开始）
print(house_prices[-1])  # 最后一个元素：300（-1表示倒数第一个）

# 3. 获取列表长度：查看列表中有多少个元素
print(len(house_prices))  # 输出：5

# 4. 添加元素：在列表末尾添加新数据
house_prices.append(350)  # 添加350到列表末尾
print(house_prices)        # 输出：[100, 150, 200, 250, 300, 350]

# 5. 遍历列表：依次访问列表中的每个元素
# for 循环：对列表中的每个元素执行相同操作
for p in house_prices:
    print(p)  # 依次打印每个房价
```

**练习题：** 创建一个包含 5 个学生成绩的列表，打印第一个和最后一个成绩。

**提示：**

- 使用方括号创建列表，例如：`[85, 90, 78, 92, 88]`
- 使用 `[0]` 访问第一个元素，`[-1]` 访问最后一个元素

## 导入库与函数调用

**什么是库？** 库（Library）就像是一个"工具箱"，里面装满了别人已经写好的实用工具（函数）。我们不需要自己写代码实现所有功能，直接使用库里的工具就可以了。

**为什么要用库？**

- 节省时间：不需要重复造轮子
- 功能强大：专业库经过优化，性能更好
- 标准化：大家都在用，代码更容易理解

**Python 常用库：**

- `math`：数学函数（开方、三角函数等）
- `statistics`：统计函数（平均值、中位数等）
- `pandas`：数据处理（后续会学）
- `matplotlib`：画图（后续会学）
- `sklearn`：机器学习（后续会学）

下面看看如何使用库：

```{python}
#| message: false
#| warning: false
# 方式1：导入整个库，使用时需要加库名
import math              # 导入数学库
x = 16
print(math.sqrt(x))      # 使用 math.sqrt() 计算平方根，输出：4.0

# 方式2：只导入需要的函数，使用时不需要加库名
from statistics import mean  # 从 statistics 库中导入 mean 函数
scores = [85, 90, 78, 92, 88]
print("平均分:", mean(scores))  # 直接使用 mean() 计算平均值，输出：86.6
```

**练习题：** 导入 `statistics` 库，计算 `[10, 20, 30, 40, 50]` 的平均值和中位数。

**提示：**

- 使用 `from statistics import mean, median` 导入两个函数
- 或者使用 `import statistics`，然后通过 `statistics.mean()` 和 `statistics.median()` 调用
- 中位数函数是 `median()`，用法和 `mean()` 一样

## 第一个机器学习程序：线性回归

**什么是机器学习？** 简单来说，就是让计算机从数据中"学习"规律，然后用学到的规律做预测。

**这个例子要做什么？** 我们要让计算机学习"房屋面积和价格的关系"，然后预测新房子的价格。

**机器学习的基本流程：**

1. 准备数据（历史数据：已知面积和价格）
2. 训练模型（让计算机学习规律）
3. 预测新数据（用学到的规律预测新房子价格）
4. 可视化（画图看看效果）

下面我们一步步实现：

```{python}
#| message: false
#| warning: false
# 第一个机器学习程序：房价预测（简化版）

# ========== 第1步：导入必要的库 ==========
from sklearn.linear_model import LinearRegression  # 线性回归模型
import matplotlib.pyplot as plt                    # 画图库

# ========== 第2步：准备数据（历史数据）==========
# 这是我们的"历史数据"：8 套房子的面积和价格
areas = [50, 60, 70, 80, 90, 100, 110, 120]      # 房屋面积（平米）
prices = [150, 180, 210, 240, 270, 300, 330, 360] # 对应价格（万元）

# 观察：面积越大，价格越高，看起来是线性关系

# ========== 第3步：数据格式转换 ==========
# sklearn 要求特征 X 是二维数组格式
# [[50], [60], [70], ...] 而不是 [50, 60, 70, ...]
X = [[a] for a in areas]  # 特征（输入）：房屋面积
y = prices                # 标签（输出）：房屋价格

# ========== 第4步：创建模型 ==========
model = LinearRegression()  # 创建一个线性回归模型

# ========== 第5步：训练模型 ==========
# fit() 就是"训练"：让模型从数据中学习规律
# 模型会找到一条直线，使得这条直线最接近所有数据点
model.fit(X, y)

# ========== 第6步：查看学到的参数 ==========
# 模型学到的规律可以用一条直线表示：价格 = 斜率 × 面积 + 截距
print("斜率（每平米价格）:", model.coef_[0])  # 约 3.0，表示每平米约3万元
print("截距:", model.intercept_)              # 直线的截距

# ========== 第7步：预测新数据 ==========
# 现在用训练好的模型预测 95 平米房子的价格
new_area = [[95]]  # 要预测的房子面积（注意格式：二维数组）
predicted = model.predict(new_area)[0]  # predict() 返回预测结果
print(f"95平米预测价格: {predicted:.1f} 万元")

# ========== 第8步：可视化 ==========
# 画图看看模型的拟合效果
plt.scatter(areas, prices, label='真实数据')           # 散点图：真实数据点
plt.plot(areas, model.predict(X), color='red', label='拟合直线')  # 红线：模型学到的直线
plt.xlabel('面积（平米）')
plt.ylabel('价格（万元）')
plt.legend()  # 显示图例
plt.title('房价预测')
plt.show()    # 显示图形
```

**恭喜！** 你已经完成了第一个机器学习程序！🎉

**理解要点：**

- **训练（fit）**：模型从8个历史数据中学习规律，找到最佳拟合直线
- **预测（predict）**：用学到的规律预测新数据
- **可视化**：图形帮助我们直观地看到模型的效果

**常见问题：**

- **Q：为什么 X 要写成 `[[area] for area in areas]`？**
  - A：sklearn 要求特征必须是二维数组（每行是一个样本），即使只有一个特征也要写成二维格式。后续课程会详细讲解。

- **Q：如果数据不是完美直线会怎样？**
  - A：模型会找到一条"最接近"所有数据点的直线，即使数据不完全在一条直线上。这是线性回归的核心思想：找到最佳拟合。

**互动练习：**

- 尝试修改 `new_area = [[95]]` 为其他面积（如 `[[80]]` 或 `[[120]]`），看看预测结果
- 尝试在 `areas` 和 `prices` 中添加新的数据点，观察模型如何变化
